import{_ as ae}from"./index-B68_FZo7.js";import{d as E,c as x,p as i,u as se,v as oe,a as r,b as t,m as v,t as p,A as y,B as I,V as k,W as le,e as O,w as A,i as ne,l as ie,n as re,j as L,o as n}from"./index-D0pO9Tvl.js";import{_ as de}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-scL_XI_H.js";import{I as ue}from"./InvertedButton-B43qZtpD.js";import{u as me,a as ce,b as ve,c as fe}from"./textStore-CRw0B2M-.js";import{s as w,h as xe,i as P,R as pe,a as we}from"./index-C8rzKqQ3.js";import{v as U,e as ge,a as be}from"./data-C6fO1sHB.js";import{g as ye}from"./socket-D0hgB3PH.js";import{A as ke,p as he}from"./order-CGegnj1S.js";import"./base-CHC5KoCc.js";const _e={class:"rounded-card bg-base flex flex-col gap-2.5 p-2.5 w-[95vw] h-[auto] mt-[7vh] absolute"},Se={class:"flex flex-col gap-4"},Ie={class:"flex flex-col gap-2.5"},Pe={class:"flex justify-between items-center"},qe={class:"text-larger text-common leading-none"},Ce={class:"flex justify-between items-center"},Re={class:"text-larger text-common leading-none"},Ue={class:"flex justify-between items-center"},je={class:"text-larger text-common font-bold leading-none"},Ve={class:"flex justify-between items-center"},$e={class:"text-larger font-bold leading-none text-red-500"},Te={class:"flex flex-col gap-2.5"},De={class:"flex flex-row justify-between items-center"},Be={key:0,class:"flex h-2.5"},Fe={class:"flex flex-row justify-between items-center"},ze={key:1,class:"flex h-2.5"},Oe={key:2,class:"flex flex-row justify-between items-center"},Ae={key:3,class:"flex h-2.5"},Le={key:4,class:"flex flex-row justify-between items-center"},Ee={key:5,class:"flex items-center justify-end"},Ne={key:0,class:"flex flex-row justify-between gap-2.5 w-full"},Ge={class:"h-[22px] flex flex-row justify-center items-center gap-2"},He={key:2,class:"text-larger text-inverted font-bold tracking-wide"},Me={key:3,class:"text-larger text-inverted font-bold tracking-wide"},Ke={key:4,class:"text-larger text-inverted font-bold tracking-wide"},Qe=["href"],We=E({name:"OrderConfirm"}),it=E({...We,setup(Je){const N=me(),G=x(()=>N.getTheme),H=ce(),M=x(()=>H.getRounded),K=ve(),Q=x(()=>K.getFontSize),W=fe(),j=x(()=>W.getText),V=ie(),$=se(),f=i(""),h=i(""),T=i(""),_=$.query,l=i({name:"",location:"",quantity:"",amount:"",device_id:f.value}),a=i({email:"",mobile:"",password:"",confirmPassword:""}),S=i({email:"",mobile:"",password:"",token:"",formData:""}),g=i(!1),b=i(!1),J=x(()=>U("email",a.value.email)),X=x(()=>U("mobile",a.value.mobile)),Y=x(()=>U("password",a.value.password)),q=i(!1),C=i(!1),R=i(!1),D=i(!1),u=i(!1);async function Z(){return new Promise((o,e)=>{if(q.value=a.value.email&&!J.value,C.value=!a.value.mobile||!X.value,R.value=!a.value.password||!Y.value,D.value=a.value.password!==a.value.confirmPassword,q.value||C.value||R.value||D.value){w("請正確填寫所有必填字段!"),e(new Error("驗證失敗"));return}pe(S.value).then(s=>{s.token?(localStorage.setItem("common_token",s.token),localStorage.setItem("isGuest","false"),localStorage.setItem("mobile",a.value.mobile),localStorage.setItem("email",a.value.email),we("註冊成功,請在手機上確認"),o(s)):s.error&&(w(`註冊失敗:${s.error.response.data.message}`),e(s.error))}).catch(s=>{var m,d;w(`註冊失敗:${((d=(m=s.response)==null?void 0:m.data)==null?void 0:d.message)||s.message}`),e(s)})})}const ee=()=>{u.value=!0,xe({message:"請求處理中...",forbidClick:!0,duration:0});let o=new URLSearchParams({mobile:a.value.mobile,email:a.value.email,quantity:l.value.quantity,amount:l.value.amount,device_id:f.value}).toString(),e=decodeURIComponent(o);S.value={mobile:a.value.mobile,password:a.value.password,formData:be(e),token:localStorage.getItem("common_token")},a.value.email&&(S.value={...S.value,email:a.value.email}),b.value&&g.value?Z().then(()=>{B()}).catch(()=>{u.value=!1,P()}):B()},B=()=>{ke({quantity:parseInt(l.value.quantity),deviceUuid:f.value,remark:l.value.location}).then(o=>{he({uuid:o.data.uuid}).then(e=>{if(u.value=!1,P(),e.data.wapUrl){const s=encodeURIComponent(e.data.wapUrl);h.value=e.data.redirectScriptPageURL+s,T.value=e.data.orderUuid}else w("支付鏈接不存在")}).catch(e=>{var s,m;u.value=!1,P(),w(`支付失敗:${((m=(s=e.response)==null?void 0:s.data)==null?void 0:m.message)||e.message}`)})}).catch(o=>{var e,s;u.value=!1,P(),w(`支付失敗:${((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||o.message}`)})},te=()=>{V.push({name:"PayedAfter",query:{orderId:T.value}})};return oe(async()=>{const o=$.query;let e=localStorage.getItem("isGuest");b.value=e==="true",o.token?(b.value=!1,localStorage.setItem("common_token",o.token),localStorage.setItem("mobile",o.mobile),a.value.mobile=o.mobile,l.value.quantity=o.quantity,o.email&&(localStorage.setItem("email",o.email),a.value.email=o.email),f.value=o.device_id,ye({socketId:f.value}).then(d=>{l.value.location=d.data.location,l.value.name=d.data.name,l.value.amount=ge(parseInt(l.value.quantity),d.data.priceFormula).toString()}).catch(d=>{w(`獲取信息失敗:${d.response.data.message}`)})):(f.value=o.device_id,l.value.device_id=f.value,l.value.location=_.location,l.value.name=_.name,l.value.quantity=_.quantity,l.value.amount=_.amount);let s=localStorage.getItem("mobile"),m=localStorage.getItem("email");a.value.mobile=a.value.mobile?a.value.mobile:s,a.value.email=a.value.email?a.value.email:m}),(o,e)=>{var m,d,F,z;const s=ae;return n(),r("div",{class:re([`font-${j.value} theme-color-${G.value} theme-rounded-${M.value} theme-fontsize-${Q.value} font-${j.value}`,"text-muted bg-gradient-to-b from-skin-primary to-skin-secondary h-[100vh] relative flex justify-center items-center"])},[t("div",_e,[e[19]||(e[19]=t("div",{class:"text-largest font-bold tracking-wide flex justify-center text-common"}," 訂單確認 ",-1)),t("div",Se,[t("div",Ie,[t("div",Pe,[e[6]||(e[6]=t("span",{class:"text-base text-common font-normal truncate"},"插座名稱 :",-1)),t("div",qe,p((m=l.value)==null?void 0:m.name),1)]),t("div",Ce,[e[7]||(e[7]=t("span",{class:"text-base text-common font-normal truncate"},"插座地址 :",-1)),t("div",Re,p((d=l.value)==null?void 0:d.location),1)]),t("div",Ue,[e[8]||(e[8]=t("span",{class:"text-base text-common font-normal truncate"},"租用時間 :",-1)),t("div",je,p((F=l.value)==null?void 0:F.quantity)+"H ",1)]),t("div",Ve,[e[9]||(e[9]=t("span",{class:"text-base text-common font-normal truncate"},"支付金額 :",-1)),t("div",$e,p((z=l.value)==null?void 0:z.amount)+"HKD ",1)])]),t("div",Te,[t("div",De,[e[10]||(e[10]=t("div",{class:"flex-none w-3/12 text-base text-common tracking-wider"}," 電郵 ",-1)),y(t("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=c=>a.value.email=c),type:"email",class:"flex-1 w-0 border rounded shadow-inner px-2 py-0.5 text-base text-common tracking-wide",placeholder:"請鍵入電郵"},null,512),[[I,a.value.email]])]),q.value?(n(),r("div",Be,e[11]||(e[11]=[t("span",{class:"text-red-500 text-base"},"郵箱格式不正確",-1)]))):v("",!0),t("div",Fe,[e[12]||(e[12]=t("div",{class:"flex-none w-3/12 text-base text-common tracking-wider"},[k(" 電話"),t("span",{class:"text-red-500 text-base text-center w-2.5"},"*")],-1)),y(t("input",{id:"phone","onUpdate:modelValue":e[1]||(e[1]=c=>a.value.mobile=c),type:"tel",class:"flex-1 w-0 border rounded shadow-inner px-2 py-0.5 text-base text-common tracking-wide",placeholder:"請鍵入電話"},null,512),[[I,a.value.mobile]])]),C.value?(n(),r("div",ze,e[13]||(e[13]=[t("span",{class:"text-red-500 text-base"},"手機號碼不能位空且為6~12位數字",-1)]))):v("",!0),g.value?(n(),r("div",Oe,[e[14]||(e[14]=t("div",{class:"flex-none w-3/12 text-base text-common tracking-wider"},[k(" 密碼"),t("span",{class:"text-red-500 text-base text-center w-2.5"},"*")],-1)),y(t("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=c=>a.value.password=c),type:"password",class:"flex-1 w-0 border rounded shadow-inner px-2 py-0.5 text-base text-common tracking-wide",placeholder:"請鍵入密碼"},null,512),[[I,a.value.password]])])):v("",!0),R.value?(n(),r("div",Ae,e[15]||(e[15]=[t("span",{class:"text-red-500 text-small"},"密碼不能為空且必須是6~16位",-1)]))):v("",!0),g.value?(n(),r("div",Le,[e[16]||(e[16]=t("div",{class:"flex-none w-3/12 text-base text-common tracking-wider"},[k(" 確認密碼"),t("span",{class:"text-red-500 text-base text-center w-2.5"},"*")],-1)),y(t("input",{id:"confirm-password","onUpdate:modelValue":e[3]||(e[3]=c=>a.value.confirmPassword=c),type:"password",class:"flex-1 w-0 border rounded shadow-inner px-2 py-0.5 text-base text-common tracking-wide",placeholder:"請再次鍵入密碼"},null,512),[[I,a.value.confirmPassword]])])):v("",!0),b.value?(n(),r("div",Ee,[e[17]||(e[17]=t("label",{for:"register-checkbox",class:"text-base text-common font-normal"},[k(" 同意 "),t("a",{href:"/path/to/agreement",target:"_blank",class:"text-blue-500 text-base"},"《協議》"),k("並註冊 ")],-1)),y(t("input",{id:"register-checkbox","onUpdate:modelValue":e[4]||(e[4]=c=>g.value=c),type:"checkbox",class:"mr-2 ml-2 w-4 h-4"},null,512),[[le,g.value]])])):v("",!0)]),h.value?v("",!0):(n(),r("div",Ne,[O(ue,{onClick:e[5]||(e[5]=c=>ne(V).go(-1))},{default:A(()=>e[18]||(e[18]=[t("div",{class:"w-[22vw] h-[22px] flex flex-row justify-center items-center"},[t("span",{class:"text-base text-primary font-bold font-CactusClassicalSerifHK text-center"}," 退回上頁 ")],-1)])),_:1}),O(de,{class:"grow",disabled:u.value,onClick:ee},{default:A(()=>[t("div",Ge,[u.value?(n(),L(s,{key:1,icon:"line-md:loading-twotone-loo",class:"text-[20px] animate-spin"})):(n(),L(s,{key:0,icon:"mingcute:flash-line",class:"text-[20px]"})),b.value?g.value?(n(),r("span",Ke,p(u.value?"處理中...":"註冊並支付"),1)):(n(),r("span",Me,p(u.value?"處理中...":"確認訂單"),1)):(n(),r("span",He,p(u.value?"處理中...":"確認訂單"),1))])]),_:1},8,["disabled"])])),h.value?(n(),r("a",{key:1,href:h.value,target:"_blank",class:"text-base text-center text-primary underline",onClick:te},"去支付",8,Qe)):v("",!0)])])],2)}}});export{it as default};
