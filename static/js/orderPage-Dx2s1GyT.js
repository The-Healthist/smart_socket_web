import"./base-CHC5KoCc.js";import{O as n,h as R,D as re}from"./moment-BQFaItiI.js";import{s as N,a as le}from"./index-C8rzKqQ3.js";import{_ as ee}from"./index-B68_FZo7.js";import{f as ie,c as p,a as r,o,b as e,m as u,t as b,n as c,i,e as m,w as y,d as te,p as x,q as de,v as ue,x as ce,y as fe,r as ve,F as G,z as J,A as xe,B as me,l as ge,j as Q}from"./index-D0pO9Tvl.js";import{_ as E}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-scL_XI_H.js";import{u as be,a as pe,b as we,c as ye}from"./textStore-CRw0B2M-.js";import{g as X,r as he,p as Oe,e as Se,a as ke}from"./order-CGegnj1S.js";import{e as Ce,v as je}from"./data-C6fO1sHB.js";import{I as Fe}from"./InvertedButton-B43qZtpD.js";const $e=ie({id:"order",state:()=>({orderList:[],orderListH:[]}),actions:{setOrderList(a){this.orderList=a},setOrderListH(a){this.orderListH=a},addOrder(a){this.orderList=[...this.orderList,...a]},addOrderH(a){this.orderListH=[...this.orderListH,...a]}},getters:{getOrderList:a=>a.orderList,getOrderListH:a=>a.orderListH}}),Ne={class:"w-[95vw] p-2.5 flex flex-col gap-2"},He={class:"flex justify-between items-center"},Le={key:0,class:"text-large"},ze={class:"flex justify-between items-center"},De={key:0,class:"text-large"},_e={key:0,class:"flex justify-between items-center"},Pe={class:"text-large font-bold"},Te={key:1,class:"flex justify-between items-center"},Be={class:"text-large font-bold"},Re={class:"flex justify-between items-center"},Ee={class:"flex justify-between items-center"},Me={key:2},Ie={class:"flex justify-between items-center"},Ae={class:"flex justify-between items-end"},Ve={class:"flex justify-between items-end"},Ye={key:3,class:"flex justify-between items-center"},qe={class:"text-large font-bold"},Ue={key:4},Ke={class:"flex flex-row justify-between gap-2.5 w-full"},We={key:5},Ge={class:"flex flex-row justify-between gap-2.5 w-full"},Je={key:0,class:"flex flex-row gap-2.5 w-full"},Qe={class:"grow h-[22px] flex flex-row justify-center items-center gap-2"},Xe={key:1,class:"flex flex-row gap-2.5 w-full"},Ze={class:"grow h-[22px] flex flex-row justify-center items-center gap-2"},et={key:2},tt={class:"flex flex-row justify-between gap-2.5 w-full"},st={key:3},at={class:"flex flex-row justify-between gap-2.5 w-full"},nt={key:0,class:"flex flex-row justify-center items-center gap-2.5 w-full"},Z={__name:"LazyOrderItem",props:{order:Object},emits:["endOrder","renewOrder","click"],setup(a,{emit:H}){const w=a,d=p(()=>w.order.status===n.Ended||w.order.status===n.Closed),_=p(()=>R(w.order.endAt).diff(R(),"seconds")),C=H,P=()=>{C("click",w.order.uuid)},T=f=>{C("endOrder",f)},L=f=>{C("renewOrder",f)},j=f=>R(f).format("YYYY/MM/DD HH:mm");return(f,t)=>{const g=ee;return o(),r("div",Ne,[e("div",{class:"flex flex-col gap-2.5 hover:bg-primary/10",onClick:P},[e("div",He,[t[3]||(t[3]=e("span",{class:"text-base text-baseC font-normal truncate"},"插座名稱 :",-1)),a.order.device?(o(),r("div",Le,b(a.order.device.name),1)):u("",!0)]),e("div",ze,[t[4]||(t[4]=e("span",{class:"text-base text-baseC font-normal truncate"},"插座地址 :",-1)),a.order.device?(o(),r("div",De,b(a.order.device.location),1)):u("",!0)]),d.value?(o(),r("div",_e,[t[5]||(t[5]=e("span",{class:"text-base text-baseC font-normal truncate"},"購買時間 :",-1)),e("div",Pe,b(a.order.quantity)+"H",1)])):u("",!0),d.value?(o(),r("div",Te,[t[6]||(t[6]=e("span",{class:"text-base text-baseC font-normal truncate"},"支付金額 :",-1)),e("div",Be,b(a.order.price)+"HKD",1)])):u("",!0),e("div",Re,[t[7]||(t[7]=e("span",{class:"text-base text-baseC font-normal truncate"},"開始時間 :",-1)),e("div",{class:c(["text-base font-bold",d.value?"text-baseC/40":""])},b(j(a.order.startAt)),3)]),e("div",Ee,[t[8]||(t[8]=e("span",{class:"text-base text-baseC font-normal truncate"},"結束時間 :",-1)),e("div",{class:c(["text-base font-bold",d.value?"text-baseC/40":""])},b(j(a.order.endAt)),3)]),d.value?(o(),r("div",Me,[e("div",Ie,[t[9]||(t[9]=e("span",{class:"text-base text-baseC font-normal truncate"},"支付方式 :",-1)),e("div",{class:c(["text-large font-bold",d.value?"text-baseC/40":""])},b(a.order.paymentMethod),3)]),e("div",Ae,[t[10]||(t[10]=e("span",{class:"text-base text-baseC font-normal truncate"},"訂單編號 :",-1)),e("div",{class:c(["text-small font-bold flex items-end justify-end",d.value?"text-baseC/40":""])},b(a.order.uuid),3)]),e("div",Ve,[t[11]||(t[11]=e("span",{class:"text-base text-baseC font-normal truncate"},"設備編號 :",-1)),a.order.device?(o(),r("div",{key:0,class:c(["text-small font-bold flex items-end justify-end",d.value?"text-baseC/40":""])},b(a.order.device.uuid),3)):u("",!0)])])):u("",!0),!d.value&&a.order.status===i(n).Ongoing?(o(),r("div",Ye,[t[12]||(t[12]=e("span",{class:"text-base text-baseC font-normal truncate"},"剩餘時間 :",-1)),e("div",qe,b(_.value),1)])):u("",!0),a.order.status===i(n).Pending?(o(),r("div",Ue,[e("div",Ke,[t[13]||(t[13]=e("span",{class:"text-base text-baseC font-normal truncate"},"訂單狀態 :",-1)),e("span",{class:c(["text-large font-bold",d.value?"text-baseC/40":"text-primary/60"])},"待支付",2)])])):u("",!0),a.order.status===i(n).Ongoing?(o(),r("div",We,[e("div",Ge,[t[14]||(t[14]=e("span",{class:"text-base text-baseC font-normal truncate"},"訂單狀態 :",-1)),e("span",{class:c(["text-large font-bold",d.value?"text-baseC/40":"text-[#00a5ff]"])},"使用中",2)])])):u("",!0)]),e("div",null,[a.order.status===i(n).Ongoing?(o(),r("div",Je,[m(Fe,{onClick:t[0]||(t[0]=z=>T(a.order.uuid))},{default:y(()=>t[15]||(t[15]=[e("div",{class:"w-[22vw] h-[22px] flex flex-row justify-center items-center"},[e("span",{class:"text-base text-primary font-bold font-CactusClassicalSerifHK text-center"},"結束使用")],-1)])),_:1}),m(E,{class:"grow",onClick:t[1]||(t[1]=z=>L(a.order.uuid))},{default:y(()=>[e("div",Qe,[m(g,{icon:"mingcute:flash-line",class:"text-[20px]"}),t[16]||(t[16]=e("span",{class:"text-larger text-inverted font-bold tracking-wide"},"充值續費",-1))])]),_:1})])):a.order.status===i(n).Pending?(o(),r("div",Xe,[m(E,{class:"grow",onClick:t[2]||(t[2]=z=>L(a.order.uuid))},{default:y(()=>[e("div",Ze,[m(g,{icon:"mingcute:flash-line",class:"text-[20px]"}),t[17]||(t[17]=e("span",{class:"text-larger text-inverted font-bold tracking-wide"},"支付訂單",-1))])]),_:1})])):a.order.status===i(n).Ended?(o(),r("div",et,[e("div",tt,[t[18]||(t[18]=e("span",{class:"text-base text-baseC font-normal truncate"},"訂單狀態 :",-1)),e("span",{class:c(["text-large font-bold",d.value?"text-baseC/40":""])},"已結束",2)])])):a.order.status===i(n).Closed?(o(),r("div",st,[e("div",at,[t[19]||(t[19]=e("span",{class:"text-base text-baseC font-normal truncate"},"訂單狀態 :",-1)),e("span",{class:c(["text-large font-bold",d.value?"text-baseC/40":""])},"已關閉",2)])])):u("",!0)]),a.order.status!==i(n).Pending&&a.order.status!==i(n).Ongoing?(o(),r("div",nt,t[20]||(t[20]=[e("button",{class:"text-primary text-base font-normal"}," 有疑問？聯繫客服 ",-1)]))):u("",!0),t[21]||(t[21]=e("div",{class:"bg-separator/30 flex flex-row justify-center w-full h-[1px]"},null,-1))])}}},ot={class:"flex flex-col w-full h-full justify-center items-center px-2.5 py-5"},rt={class:"w-[95vw] h-full flex flex-col"},lt={class:"flex flex-row gap-0 relative"},it={key:0},dt={key:1},ut={key:2},ct={class:"flex flex-col h-[40vh] bg-gradient-to-b from-skin-primary/10 to-skin-primary/30 items-center p-2.5 gap-2.5"},ft={class:"flex flex-row items-center w-full -ml-2.5"},vt={class:"-mt-2 w-full h-[38px] p-[5px] bg-base justify-center items-center rounded-button border-solid border-[2px]"},xt={class:"flex flex-row"},mt={class:"flex flex-row w-full ml-2 justify-between"},gt={key:0,class:"text-primary text-base mr-[26px]"},bt={key:0,class:"h-2.5 w-full -mt-2.5 text-base ml-[2px] text-red-500"},pt={class:"h-[24px] flex flex-row justify-center items-center gap-2"},wt=te({name:"OrderPage"}),Ht=te({...wt,setup(a){const H=ge(),w=be();w.themes;const d=p(()=>w.getTheme),_=pe(),C=p(()=>_.getRounded),P=we(),T=p(()=>P.getFontSize),L=ye(),j=p(()=>L.getText),f=$e(),t=x(n.OrderStatusNoneFinished),g=x([]),z=p(()=>g.value),h=x([]),D=x(!1),M=x(""),F=x(2),se=p(()=>Ce(F.value,B.value)),I=x(!1),ae=p(()=>je("numberM",F.value)),O=x({pageNum:1,pageSize:5}),A=x(10),S=x({pageNum:1,pageSize:5}),V=x(10);de(t,l=>{l===n.OrderStatusNoneFinished?(O.value.pageNum=1,g.value=[]):l===n.OrderStatusFinished&&(S.value.pageNum=1,h.value=[]),k()});const Y=async l=>{Se({uuid:l}).then(s=>{console.log(s);let $=s;g.value=$,console.log(g.value),le("訂單已取消"),k()}).catch(s=>{console.log(s),N(`取消訂單失敗:${s.response.data.message}`)})},B=x(),q=async l=>{ke({uuid:l}).then(s=>{s.data.device.priceFormula?(console.log(s.data.device.priceFormula),B.value=s.data.device.priceFormula,k()):console.log("Price formula not found")}).catch(s=>{console.log(s),N(`獲取訂單失敗:${s.response.data.message}`)}),M.value=l,D.value=!0},ne=async()=>{ae.value||(I.value=!0),he({uuid:M.value,duration:F.value}).then(l=>{console.log(l),Oe({uuid:l.data.uuid}).then(s=>{console.log(s),H.push({name:"PayedAfter",query:{orderId:l.data.uuid}})}).catch(s=>{console.log(s),N(`支付失敗:${s.response.data.message}`)}),D.value=!1})},k=async()=>{let l=localStorage.getItem("mobile");t.value===n.OrderStatusNoneFinished?X({mobile:l,status:n.OrderStatusNoneFinished,pageNum:O.value.pageNum,pageSize:O.value.pageSize}).then(s=>{console.log(s),g.value=O.value.pageNum===1?s.data:[...g.value,...s.data],f.addOrder(s.data),A.value=s.pagination.total}).catch(s=>{console.log(s),N(`獲取使用中訂單失敗:${s.response.data.message}`)}):t.value===n.OrderStatusFinished&&X({mobile:l,status:n.OrderStatusFinished,pageNum:S.value.pageNum,pageSize:S.value.pageSize}).then(s=>{h.value=S.value.pageNum===1?s.data:[...h.value,...s.data],f.addOrderH(s.data),V.value=s.pagination.total}).catch(s=>{console.log(s),N(`獲取歷史訂單失敗:${s.response.data.message}`)})};ue(async()=>{f.getOrderList.length===0&&f.getOrderListH.length===0?k():t.value===n.OrderStatusNoneFinished?g.value=f.getOrderList:t.value===n.OrderStatusFinished&&(h.value=f.getOrderListH)});const U=l=>{H.push({name:"OrderDetail",query:{uuid:l}})},K=()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight&&(t.value===n.OrderStatusNoneFinished&&O.value.pageNum<A.value?(O.value.pageNum+=1,k()):t.value===n.OrderStatusFinished&&S.value.pageNum<V.value&&(S.value.pageNum+=1,k()))};return ce(()=>{window.addEventListener("scroll",K)}),fe(()=>{window.removeEventListener("scroll",K)}),(l,s)=>{const $=ee,W=ve("lazy-component"),oe=re;return o(),r("div",{class:c([` font-${j.value} theme-color-${d.value} theme-rounded-${C.value} theme-fontsize-${T.value} font-${j.value}`,"text-muted bg-gradient-to-b from-skin-primary to-skin-primary/10 h-[100vh]"])},[e("div",ot,[e("div",rt,[e("div",lt,[e("div",{class:c(["w-[47.5vw] h-[42px] flex justify-center items-center relative overflow-hidden",t.value===i(n).OrderStatusNoneFinished?"bg-primary":"bg-base"])},[e("button",{class:c(["w-full h-full flex flex-row gap-2.5 justify-center items-center relative z-10",t.value===i(n).OrderStatusNoneFinished?"text-primary bg-base rounded-t-bar":"text-inverted bg-primary rounded-br-bar"]),onClick:s[0]||(s[0]=v=>t.value=i(n).OrderStatusNoneFinished)},[s[4]||(s[4]=e("span",{class:"text-large"},"使用中",-1)),m($,{icon:"mingcute:flash-line",class:"text-[20px]"})],2)],2),e("div",{class:c(["w-[47.5vw] h-[42px] flex justify-center items-center relative overflow-hidden",t.value===i(n).OrderStatusFinished?"bg-primary ":"bg-base "])},[e("button",{class:c(["w-full h-full flex flex-row gap-2.5 justify-center items-center relative z-10",t.value===i(n).OrderStatusFinished?"text-primary bg-base rounded-t-bar":"text-inverted bg-primary rounded-bl-bar"]),onClick:s[1]||(s[1]=v=>t.value=i(n).OrderStatusFinished)},[m($,{icon:"tabler:clock",class:"text-[20px]"}),s[5]||(s[5]=e("span",{class:"text-base"},"歷史訂單",-1))],2)],2)]),e("div",{class:c(["bg-base w-[95vw] h-[auto] min-h-[80vh] flex flex-col overflow-y-scroll pb-12",t.value===i(n).OrderStatusNoneFinished?"rounded-tr-bar rounded-b-card":"rounded-tl-bar rounded-b-card"])},[z.value.length===0&&h.value.length===0?(o(),r("div",it,s[6]||(s[6]=[e("div",{class:"flex flex-col justify-center items-center h-[50vh]"},[e("span",{class:"text-baseC"},"暫無數據")],-1)]))):u("",!0),t.value===i(n).OrderStatusNoneFinished?(o(),r("div",dt,[m(W,{"error-text":"加載失敗","loading-text":"加載中"},{default:y(()=>[(o(!0),r(G,null,J(g.value,v=>(o(),r("div",{key:v.uuid},[(o(),Q(Z,{key:v.uuid,order:v,onClick:U,onEndOrder:Y,onRenewOrder:q},null,8,["order"]))]))),128))]),_:1})])):t.value===i(n).OrderStatusFinished?(o(),r("div",ut,[m(W,{"error-text":"加載失敗","loading-text":"加載中"},{default:y(()=>[(o(!0),r(G,null,J(h.value,v=>(o(),r("div",{key:v.uuid},[(o(),Q(Z,{key:v.uuid,order:v,onClick:U,onEndOrder:Y,onRenewOrder:q},null,8,["order"]))]))),128))]),_:1})])):u("",!0)],2)])]),m(oe,{show:D.value,"onUpdate:show":s[3]||(s[3]=v=>D.value=v),"show-cancel-button":!1,showConfirmButton:!1,"close-on-click-overlay":!0},{default:y(()=>[e("div",ct,[s[11]||(s[11]=e("h1",{class:"text-largest test-basec"},"充值續費",-1)),s[12]||(s[12]=e("span",{class:"flex flex-row justify-start text-baseC text-base w-full ml-2.5"},"充值時間",-1)),e("div",ft,[s[8]||(s[8]=e("span",{class:"text-primary text-base"},"*",-1)),e("div",vt,[e("div",xt,[xe(e("input",{id:"number","onUpdate:modelValue":s[2]||(s[2]=v=>F.value=v),type:"number",placeholder:"請輸入充值時間",class:"w-[60vw] h-[24px] pl-2 rounded-button"},null,512),[[me,F.value]]),s[7]||(s[7]=e("span",{class:"text-primary text-base mr-1.5"},"/小時",-1))])])]),e("div",mt,[s[9]||(s[9]=e("span",{class:"flex flex-row justify-start text-baseC text-base w-full"}," 總計金額",-1)),B.value?(o(),r("span",gt,b(se.value)+"HKD",1)):u("",!0)]),I.value?(o(),r("span",bt," 充值時間需要>0且為整數 ")):u("",!0),m(E,{class:"w-[98%]",onClick:ne},{default:y(()=>[e("div",pt,[m($,{icon:"mingcute:flash-line",class:"text-[20px]"}),s[10]||(s[10]=e("span",{class:"text-larger text-inverted font-bold tracking-wide"},"即刻支付",-1))])]),_:1})])]),_:1},8,["show"])],2)}}});export{Ht as default};
